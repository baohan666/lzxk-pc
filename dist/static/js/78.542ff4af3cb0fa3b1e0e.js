webpackJsonp([78],{"ATt+":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=a("3cXf"),s=a.n(i),o=a("4YfN"),n=a.n(o),l=a("ROW2"),r=a("Agyp"),c=a("XH94"),d=a("zY1m"),p=a("a9+l"),u=a("olSa"),h=a("vWac"),m=a("oynX"),g=a("55Vu"),v=a("/wGB"),y={data:function(){return{id:"",policyTypes:"",policyTypeCheck:"",policyType:"",policyStartDate:"",policyEndDate:"",title:"",verificationStartDate:"",verificationEndDate:"",departmentId:"",departmentIds:"",departmentMenu:[],remark:"",tableData1:[],tableData2:[],tableData3:[],rangeList:[],userId:[],goodsList:"",isradio:!1,dialogSeleGoodsVisible:!1,tableData:[{goodsNamem:"",specsMaxm:""}],selectType:"",mainList:[],subList:[],goodsIdm:[],goodsId:[],pageIndex:1,pageSize:10,dialogRangeVisible:!1,awardGoods:"show"}},created:function(){this.initData()},components:{goBack:r.a,departComponet:c.a,datepicker:d.a,elPagination:p.a,selectGoods:u.a,mainTable:m.a,subTable:g.a,releaseRange:h.a},methods:{initData:function(){var e=this;this.departmentMenu=JSON.parse(Object(l.b)("departmentMenu")),Object(v.d)({policyId:this.$route.query.id,policyType:this.$route.query.type}).then(function(t){var a=t.data.data;e.id=a.id,e.policyTypes=a.policyTypeStr,e.policyType=a.policyType,e.policyTypeCheck=a.policyTypeCheck+"",e.policyStartDate=a.policyStartDate,e.policyEndDate=a.policyEndDate,e.title=a.title,e.verificationStartDate=a.verificationStartDate,e.verificationEndDate=a.verificationEndDate,e.departmentId=a.departmentIdStr,e.departmentIds=a.departmentIdStr,e.remark=a.remark,a.rangeList.forEach(function(t){1==t.isChoose&&e.userId.push(t.userId)}),e.mainList=a.mainList,e.subList=a.subList,e.mainList&&e.mainList.forEach(function(t){e.goodsIdm.push(t.goodsId)}),e.subList&&e.subList.forEach(function(t){e.goodsId.push(t.goodsId)}),e.rangeList=a.rangeList,2==a.policyType&&(e.tableData1=a.subList),3==a.policyType&&a.subList.forEach(function(t,i,s){console.log(t),console.log(a.mainList[0]);var o=n()({},t,a.mainList[0]);e.tableData2.push(o)}),4==a.policyType&&a.subList.forEach(function(t,i,s){var o={};e.mainList=a.mainList,e.subList=a.subList,o=a.mainList.length-1<i?n()({},t,a.mainList[a.mainList.length-1]):n()({},t,a.mainList[i]),e.tableData3.push(o)})})},changeSelect:function(e,t){console.log(e,t),"policyValidDate"==t?"startDate"==e.type?this.policyStartDate=e.data:this.policyEndDate=e.data:"startDate"==e.type?this.verificationStartDate=e.data:this.verificationEndDate=e.data},selectAwardGoods:function(e){var t=this;void 0!=e.handleType&&(this.handleType=e.handleType),1==e.pageIndex&&(this.pageIndex=e.pageIndex),"1"==e.handleType?this.selectType="mulAwardGoods":this.selectType="";var a={departmentIds:this.departmentId,goodsName:void 0==e.name?"":e.name,pageIndex:this.pageIndex,pageSize:this.pageSize};""!=this.departmentId&&""!=this.policyType?2!=this.policyType&&"show"==this.awardGoods||2==this.policyType||2!=this.policyType&&this.mainList.length>0?Object(v.a)(a).then(function(e){t.goodsList=e.data.data,t.$refs.dialogSeleGoods.dialogShow()}):2!=this.policyType&&0==this.mainList.length&&"hide"==this.awardGoods&&(this.isHuiKuan=!0,this.awardGoods="show"):this.$message.success("请先选择政策类型和事业部")},handleInput2:function(e){e.target.value=e.target.value.match(/^\d*(\.?\d{0,1})/g)[0]||null},uploadData:function(e){var t=this;2==this.policyType?(e.forEach(function(e,a,i){if(!t.goodsId.includes(e.id)){var s={goodsId:e.id,awardNum:"",afterDiscountPrice:"",batchNumber:"",goodsName:e.goodsName,specsMax:e.specsMax};t.tableData1.push(s),t.goodsId.push(e.id),t.clearProvMange()}}),this.awardGoods="show"):2!=this.policyType&&(1==this.handleType?e.forEach(function(e,a,i){if(!t.goodsIdm.includes(e.id)){var s;s={goodsIdm:e.id,goodsNamem:e.goodsName,specsMaxm:e.specsMax,collectionNum:""},t.mainList.push(s),t.goodsIdm.push(e.id),t.clearProvMange()}}):2==this.handleType&&e.forEach(function(e,a,i){if(!t.goodsId.includes(e.id)){var s;s={goodsId:e.id,awardNum:"",afterDiscountPrice:"",batchNumber:"",goodsName:e.goodsName,specsMax:e.specsMax},t.subList.push(s),t.goodsId.push(e.id),t.clearProvMange()}}),this.tableData2=[],this.tableData3=[],this.subList.forEach(function(e,a,i){var s={};s=t.mainList.length-1<a?n()({},e,t.mainList[t.mainList.length-1]):n()({},e,t.mainList[a]),3==t.policyType?t.tableData2.push(s):t.tableData3.push(s)}),this.tableData=this.mainList,this.awardGoods="show")},objectSpanMethod:function(e){e.row,e.column;var t=e.rowIndex,a=e.columnIndex;if(console.log(this.mainList.length,this.subList.length),3==this.policyType&&this.subList.length>1){if(0===a){var i=new Array(7).fill(0);return i[0]=this.subList.length,{rowspan:i[t],colspan:1}}}else if(4==this.policyType&&this.subList.length>0){if(0===a){for(var o=parseFloat(this.subList.length/this.mainList.length),n=(this.subList.length,this.mainList.length,[]),l=[],r=0;r<this.subList.length;r++)n.push(r);for(var c=0;c<n.length;c+=o)l.push(n.slice(c,c+o));console.log("mergeMain",s()(l));for(var d=0;d<l.length;d++)for(var p=l[d],u=0;u<p.length;u++){var h=p[u];if(console.log("element",p[u]),t==h){if(0==u)return{rowspan:p.length,colspan:1};if(0!=u)return{rowspan:0,colspan:0}}}}}else if(this.mainList.length>1&&0==this.subList.length&&1===a)for(var m=0;m<1;m++)if(0==t){if(0==m)return{rowspan:this.mainList.length,colspan:1};if(0!=m)return{rowspan:0,colspan:0}}},renderHeader:function(e){var t=this;return e("div",[e("span","奖励商品"),e("el-button",{class:["el-button--small"],on:{click:function(){t.selectAwardGoods({})}}},"添加奖励商品")])},renderHeader1:function(e){var t=this;return e("div",[e("span","需回款商品"),e("el-button",{class:["el-button--small"],on:{click:function(){t.selectAwardGoods()}}},"添加需回款商品")])},delItem:function(e){1==e.handleType&&(this.mainList=this.mainList.filter(function(t){return t.goodsIdm!=e.goodId}),this.goodsIdm=this.goodsIdm.filter(function(t){return t!=e.goodId})),2==e.handleType&&(this.subList=this.subList.filter(function(t){return t.goodsId!=e.goodId}),this.goodsId=this.goodsId.filter(function(t){return t!=e.goodId})),this.clearProvMange()},deleScopeRow:function(e){this.tableData1=this.tableData1.filter(function(t){return t.goodsId!=e}),this.goodsId=this.goodsId.filter(function(t){return t!=e}),this.clearProvMange()},policyChange:function(e){this.policyType=e,this.awardGoods="hide",this.isHuiKuan=!1,this.mainList=[],this.subList=[],this.tableData1=[],this.goodsIdm=[],this.goodsId=[],this.tableData1=[],this.tableData=[{goodsNamem:"",specsMaxm:""}],this.clearProvMange()},selectSuccess:function(e){this.departmentId=e,this.awardGoods="hide",this.mainList=[],this.subList=[],this.goodsIdm=[],this.goodsId=[],this.tableData1=[],this.tableData=[{goodsNamem:"",specsMaxm:""}]},setRange:function(){var e=this;if(this.policyTypes==this.policyType&&this.departmentId==this.departmentIds)return this.$refs.dialogSeleProMa.dialogShow(),!1;var t={departmentId:this.departmentId,goodsId:this.goodsId.toString(),goodsIdm:this.goodsIdm.toString(),policyType:this.policyType};Object(v.c)(t).then(function(t){e.rangeList=t.data.data}),this.$refs.dialogSeleProMa.dialogShow()},closeGoodsDiolog:function(){this.dialogSeleGoodsVisible=!1},closeDiolog:function(){this.dialogRangeVisible=!1},updataPage:function(e){this.pageIndex=e.pageIndex,this.pageSize=e.pageSize;var t=this.getsearchInfo(this.pageIndex,this.pageSize);this.initData(t)},setProvMange:function(e){var t=this;this.userId=[],e.forEach(function(e){console.log(e),t.userId.push(e.userId)})},getGoodsList:function(e){var t=this;this.pageIndex=e.pageIndex,this.pageSize=e.pageSize;var a={departmentIds:this.departmentId,goodsName:this.$refs.dialogSeleGoods.formInline.goodsName,pageIndex:this.pageIndex,pageSize:this.pageSize};Object(v.a)(a).then(function(e){t.goodsList=e.data.data})},clearProvMange:function(){this.userId=[],this.$refs.dialogSeleProMa.isHuixian=!1},saveAddPolGoods:function(){var e=this;if(""==this.policyType)return this.$message.success("请选择政策类型"),!1;if(""==this.title.trim())return this.$message.success("请输入政策名称"),!1;if(2==this.policyType&&""==this.policyTypeCheck)return this.$message.success("请选择政策子类型"),!1;if(""==this.policyStartDate||""==this.policyEndDate)return this.$message.success("请选择政策有效期"),!1;if(""==this.departmentId)return this.$message.success("请选择事业部"),!1;var t=[],a=!1;if(2==this.policyType)if(this.tableData1.length>0){var i={},o=0;this.tableData1.slice().reverse().forEach(function(a){a.awardNum.toString().length>0&&a.afterDiscountPrice.toString().length>0?(o+=1,i={goodsId:a.goodsId,awardNum:a.awardNum,discountPrice:a.afterDiscountPrice,batchNumber:a.batchNumber},t.push(i)):0==a.awardNum.length.toString()?e.$message.success("请输入【"+a.goodsName+"】的奖励数量"):0==a.afterDiscountPrice.toString().length&&e.$message.success("请输入【"+a.goodsName+"】的折后价")}),a=o==this.tableData1.length}else this.$message.success("请完善政策规则");else{var n=[],l=[];if(0==this.mainList.length)return this.$message.success("请添加需回款的商品"),a=!1,!1;var r={},c=0;if(this.mainList.slice().reverse().forEach(function(t){t.collectionNum.toString().length>0?(c+=1,r={goodsId:t.goodsIdm,collectionNum:t.collectionNum},n.push(r)):0==t.collectionNum.toString().length&&e.$message.success("请输入【"+t.goodsNamem+"】的回款商品数量")}),a=c==this.mainList.length,0==this.subList.length)return this.$message.success("请添加奖励的商品"),a=!1,!1;var d={},p=0;this.subList.slice().reverse().forEach(function(t){t.awardNum.toString().length>0&&t.afterDiscountPrice.toString().length>0?(p+=1,d={goodsId:t.goodsId,awardNum:t.awardNum,discountPrice:t.afterDiscountPrice,batchNumber:t.batchNumber},l.push(d)):0==t.awardNum.toString().length?e.$message.success("请输入【"+t.goodsName+"】的奖励数量"):0==t.afterDiscountPrice.toString().length&&e.$message.success("请输入【"+t.goodsName+"】的折后价")}),a=p==this.subList.length,t={mainArray:n,subArray:l}}if(""==this.userId.length)return this.$message.success("请设置适用范围"),a=!1,!1;if(a)if(1==this.$route.query.handleType){var u={id:this.id,policyType:this.policyType,policyStartDate:this.policyStartDate,policyEndDate:this.policyEndDate,title:this.title,verificationStartDate:this.verificationStartDate,verificationEndDate:this.verificationEndDate,departmentId:this.departmentId,remark:this.remark,policyRule:s()(t),policyRange:this.userId.toString(),policyTypeCheck:"null"==this.policyTypeCheck?"":this.policyTypeCheck};Object(v.g)(u).then(function(t){1==t.data.code?e.$router.go(-1):e.$message.success(t.data.msg)})}else{var h={policyType:this.policyType,policyStartDate:this.policyStartDate,policyEndDate:this.policyEndDate,title:this.title,verificationStartDate:this.verificationStartDate,verificationEndDate:this.verificationEndDate,departmentId:this.departmentId,remark:this.remark,policyRule:s()(t),policyRange:this.userId.toString(),policyTypeCheck:"null"==this.policyTypeCheck?"":this.policyTypeCheck};Object(v.f)(h).then(function(t){1==t.data.code?e.$router.go(-1):e.$message.success(t.data.msg)})}}}},f={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"create_wraper"},[1==this.$route.query.handleType?a("go-back",{attrs:{title:"编辑促销政策"}}):a("go-back",{attrs:{title:"复制促销政策"}}),e._v(" "),a("el-form",{ref:"ruleForm",staticClass:"demo-form-inline",attrs:{inline:!0,"label-width":"100px"}},[a("div",{staticClass:"containInfo_wraper"},[a("div",{staticClass:"detail_title"},[a("i",{staticClass:"line_Icon"}),e._v("基本信息：")]),e._v(" "),a("div",{staticClass:"detail_content"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:7}},[a("el-form-item",{staticClass:"is-required",attrs:{label:"政策类型："}},[a("el-select",{attrs:{placeholder:"请选择政策类型"},on:{change:e.policyChange},model:{value:e.policyTypes,callback:function(t){e.policyTypes=t},expression:"policyTypes"}},[a("el-option",{key:"1",attrs:{label:"奖励政策",value:"2"}}),e._v(" "),3==e.policyType?a("el-option",{key:"2",attrs:{label:"回款奖励",value:"3"}}):4==e.policyType?a("el-option",{key:"3",attrs:{label:"回款奖励",value:"4"}}):a("el-option",{key:"2",attrs:{label:"回款奖励",value:"3"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{staticClass:" is-required",attrs:{label:"政策名称："}},[a("el-input",{attrs:{placeholder:"请输入政策名称"},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"div-inline el-form-item is-required"},[a("div",{staticClass:"div-inline el-form-item__label"},[e._v("政策有效期：")]),e._v(" "),a("datepicker",{staticClass:"div-inline",attrs:{startIsShow:"true",endIsShow:"true",starTim:e.policyStartDate,endTim:e.policyEndDate},on:{changeSelect:function(t){return e.changeSelect(t,"policyValidDate")}}})],1)]),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{staticClass:"is-required",attrs:{label:"事业部："}},[a("el-select",{attrs:{placeholder:"请选择事业部"},on:{change:e.selectSuccess},model:{value:e.departmentId,callback:function(t){e.departmentId=t},expression:"departmentId"}},[a("el-option",{attrs:{label:"请选择事业部",value:""}}),e._v(" "),e._l(e.departmentMenu,function(e,t,i){return a("el-option",{key:i,attrs:{label:e,value:t}})})],2)],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("div",{staticClass:"div-inline el-form-item"},[a("div",{staticClass:"div-inline"},[e._v("核销期间：")]),e._v(" "),a("datepicker",{staticClass:"div-inline",attrs:{startIsShow:"true",endIsShow:"true",starTim:e.verificationStartDate,endTim:e.verificationEndDate},on:{changeSelect:function(t){return e.changeSelect(t,"verifyDate")}}})],1)]),e._v(" "),a("el-col",{directives:[{name:"show",rawName:"v-show",value:2==e.policyType,expression:"policyType==2"}],attrs:{span:7}},[a("div",{staticClass:"div-inline el-form-item is-required"},[a("div",{staticClass:"div-inline el-form-item__label"},[e._v("政策子类型：")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择政策子类型"},model:{value:null==e.policyTypeCheck?"":e.policyTypeCheck,callback:function(t){null!=e.policyTypeCheck&&(e.policyTypeCheck=t)},expression:"policyTypeCheck == null?'':policyTypeCheck"}},[a("el-option",{attrs:{label:"请选择政策子类型",value:""}}),e._v(" "),a("el-option",{key:"1",attrs:{label:"人员变动",value:"1"}}),e._v(" "),a("el-option",{key:"2",attrs:{label:"库存处理",value:"2"}}),e._v(" "),a("el-option",{key:"3",attrs:{label:"纯回款奖励",value:"3"}}),e._v(" "),a("el-option",{key:"4",attrs:{label:"会议奖励",value:"4"}})],1)],1)])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:20}},[e._v("政策说明:"),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"remark"}],staticClass:"poliyMark",attrs:{name:"",id:"",cols:"30",rows:"10"},domProps:{value:e.remark},on:{input:function(t){t.target.composing||(e.remark=t.target.value)}}})])],1)],1)]),e._v(" "),a("div",{staticClass:"containInfo_wraper"},[a("div",{staticClass:"detail_title"},[a("i",{staticClass:"line_Icon"}),e._v("政策规则")]),e._v(" "),a("div",{staticClass:"table_wrap"},[a("select-goods",{ref:"dialogSeleGoods",attrs:{title:"选择商品",goodsList:e.goodsList,policyType:e.policyType,isradio:e.isradio},on:{getGoodsList:e.getGoodsList,selectAwardGoods:e.selectAwardGoods,closeGoodsDiolog:e.closeGoodsDiolog,uploadData:e.uploadData}}),e._v(" "),"hide"==e.awardGoods?a("div",{staticClass:"viewRemark",on:{click:e.selectAwardGoods}},[e._v("请选择需回款商品")]):e._e(),e._v(" "),"show"==e.awardGoods?a("div",[2==e.policyType?a("el-table",{attrs:{data:e.tableData1,border:"","tooltip-effect":"dark"}},[a("el-table-column",{attrs:{"render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[a("div",[e._v(e._s(t.row.goodsName)),a("span",{staticClass:"viewRemark",on:{click:function(a){e.deleScopeRow(t.row.goodsId)}}},[e._v("删除")])]),e._v(" "),a("div",[e._v(e._s(t.row.specsMax))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"awardNum",label:"奖励数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("input",{directives:[{name:"model",rawName:"v-model",value:t.row.awardNum,expression:"scope.row.awardNum"},{name:"vue-onkeypress",rawName:"v-vue-onkeypress"}],staticClass:"tableInput",attrs:{type:"number",oninput:"if(value.length>8)value=value.slice(0,8)"},domProps:{value:t.row.awardNum},on:{input:function(a){a.target.composing||e.$set(t.row,"awardNum",a.target.value)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"afterDiscountPrice",label:"折后价"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("input",{directives:[{name:"model",rawName:"v-model",value:t.row.afterDiscountPrice,expression:"scope.row.afterDiscountPrice"}],staticClass:"tableInput",attrs:{type:"number"},domProps:{value:t.row.afterDiscountPrice},on:{keydown:e.handleInput2,input:function(a){a.target.composing||e.$set(t.row,"afterDiscountPrice",a.target.value)}}})]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"batchNumber",label:"指定批号"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("input",{directives:[{name:"model",rawName:"v-model",value:t.row.batchNumber,expression:"scope.row.batchNumber"},{name:"vue-onkeypress",rawName:"v-vue-onkeypress"}],staticClass:"tableInput",domProps:{value:t.row.batchNumber},on:{input:function(a){a.target.composing||e.$set(t.row,"batchNumber",a.target.value)}}})]}}])})],1):e._e(),e._v(" "),3==e.policyType||4==e.policyType?[a("mainTable",{attrs:{items:e.mainList},on:{selectAwardGoods:e.selectAwardGoods,delItem:e.delItem}}),e._v(" "),a("subTable",{attrs:{items:e.subList},on:{selectAwardGoods:e.selectAwardGoods,delItem:e.delItem}})]:e._e()],2):e._e()],1)]),e._v(" "),a("div",{staticClass:"containInfo_wraper"},[a("div",{staticClass:"detail_title"},[a("i",{staticClass:"line_Icon"}),e._v("适用范围")]),e._v(" "),a("div",{staticClass:"detail_table"},[a("span",{staticClass:"viewRemark",on:{click:function(t){e.setRange()}}},[e._v("设置")]),e._v(" "),a("releaseRange",{ref:"dialogSeleProMa",attrs:{isView:!1,dialogRangeVisible:e.dialogRangeVisible,relRangeList:e.rangeList,title:"发布范围"},on:{setProvMange:e.setProvMange}})],1)])]),e._v(" "),a("div",{staticClass:"operateWraper"},[a("div",{staticClass:"div-inline el-button-red",on:{click:e.saveAddPolGoods}},[e._v("保存")])])],1)},staticRenderFns:[]};var b=a("C7Lr")(y,f,!1,function(e){a("czKV")},"data-v-2a69d255",null);t.default=b.exports},czKV:function(e,t){}});
//# sourceMappingURL=78.542ff4af3cb0fa3b1e0e.js.map