webpackJsonp([29],{Gx5l:function(e,t){},OX9A:function(e,t){},nD4z:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=s("3cXf"),i=s.n(a),o=s("4YfN"),r=s.n(o),l=s("Agyp"),n=s("XH94"),d=s("zY1m"),c=s("a9+l"),u=s("olSa"),m=s("tA6g"),p=s("oynX"),h=s("55Vu"),g=s("cbU5"),v={data:function(){return{ruleForm:{policyType:"",policyTypeCheck:"",policyStartDate:"",policyEndDate:"",title:"",verificationStartDate:"",verificationEndDate:"",remark:"",tableData1:[],tableData2:[],tableData5:[],tableData3:[],tableData6:[],rangeList:[],userId:[]},goodsList:"",policyType:"",isradio:!1,dialogSeleGoodsVisible:!1,tableData:[{goodsNamem:"",specsMaxm:""}],selectType:"",mainList:[],subList:[],goodsIdm:[],goodsId:[],pageIndex:1,pageSize:10,dialogRangeVisible:!1,awardGoods:"hide",handleType:"",isHuiKuan:!1}},created:function(){},components:{goBack:l.a,departComponet:n.a,datepicker:d.a,elPagination:c.a,selectGoods:u.a,releaseRange:m.a,mainTable:p.a,subTable:h.a},methods:{changeSelect:function(e,t){console.log(e,t),"policyValidDate"==t?"startDate"==e.type?this.ruleForm.policyStartDate=e.data:this.ruleForm.policyEndDate=e.data:"startDate"==e.type?this.ruleForm.verificationStartDate=e.data:this.ruleForm.verificationEndDate=e.data},selectAwardGoods:function(e){var t=this;void 0!=e.handleType&&(this.handleType=e.handleType),1==e.pageIndex&&(this.pageIndex=e.pageIndex),"1"==e.handleType?this.selectType="mulAwardGoods":this.selectType="";var s={goodsName:void 0==e.name?"":e.name,pageIndex:this.pageIndex,pageSize:this.pageSize};""!=this.policyType?2!=this.policyType&&"show"==this.awardGoods||2==this.policyType||2!=this.policyType&&this.mainList.length>0?Object(g.a)(s).then(function(e){t.goodsList=e.data.data,t.$refs.dialogSeleGoods.dialogShow()}):2!=this.policyType&&0==this.mainList.length&&"hide"==this.awardGoods&&(this.awardGoods="show",this.isHuiKuan=!0):this.$message.success("请先选择政策类型")},getGoodsList:function(e){var t=this;this.pageIndex=e.pageIndex,this.pageSize=e.pageSize;var s={departmentIds:this.ruleForm.departmentId,goodsName:this.$refs.dialogSeleGoods.formInline.goodsName,pageIndex:this.pageIndex,pageSize:this.pageSize};Object(g.a)(s).then(function(e){t.goodsList=e.data.data})},handleInput2:function(e){},uploadData:function(e){var t=this;2==this.ruleForm.policyType?(e.forEach(function(e,s,a){if(!t.goodsId.includes(e.id)){var i={goodsId:e.id,awardNum:"",afterDiscountPrice:"",batchNumber:"",goodsName:e.goodsName,specsMax:e.specsMax};t.ruleForm.tableData1.push(i),t.goodsId.push(e.id),t.ruleForm.userId=[]}}),this.awardGoods="show"):2!=this.ruleForm.policyType&&(1==this.handleType?e.forEach(function(e,s,a){if(!t.goodsIdm.includes(e.id)){var i;i={goodsIdm:e.id,goodsNamem:e.goodsName,specsMaxm:e.specsMax,collectionNum:""},t.mainList.push(i),t.goodsIdm.push(e.id),t.ruleForm.userId=[]}}):2==this.handleType&&e.forEach(function(e,s,a){if(!t.goodsId.includes(e.id)){var i;i={goodsId:e.id,awardNum:"",afterDiscountPrice:"",batchNumber:"",goodsName:e.goodsName,specsMax:e.specsMax},t.subList.push(i),t.goodsId.push(e.id),t.ruleForm.userId=[]}}),this.ruleForm.tableData2=[],this.ruleForm.tableData3=[],this.subList.forEach(function(e,s,a){var i={};i=t.mainList.length-1<s?r()({},e,t.mainList[t.mainList.length-1]):r()({},e,t.mainList[s]),3==t.policyType?t.ruleForm.tableData2.push(i):t.ruleForm.tableData3.push(i)}),this.tableData=this.mainList,this.awardGoods="show")},renderHeader:function(e){var t=this;return e("div",[e("span","奖励商品"),e("el-button",{class:["el-button--small"],on:{click:function(){t.selectAwardGoods({}),console.log("赠品添加")}}},"添加奖励商品")])},renderHeader1:function(e){var t=this;return e("div",[e("span","需回款商品"),e("el-button",{class:["el-button--small"],on:{click:function(){t.selectAwardGoods(null,"mulAwardGoods"),console.log("主品添加")}}},"添加需回款商品")])},delItem:function(e){1==e.handleType&&(this.mainList=this.mainList.filter(function(t){return t.goodsIdm!=e.goodId}),this.goodsIdm=this.goodsIdm.filter(function(t){return t!=e.goodId})),2==e.handleType&&(this.subList=this.subList.filter(function(t){return t.goodsId!=e.goodId}),this.goodsId=this.goodsId.filter(function(t){return t!=e.goodId})),this.ruleForm.userId=[]},deleScopeRow:function(e){this.ruleForm.tableData1=this.ruleForm.tableData1.filter(function(t){return t.goodsId!=e}),this.goodsId=this.goodsId.filter(function(t){return t!=e}),this.ruleForm.userId=[]},policyChange:function(e){this.ruleForm.policyType=e,this.policyType=e,this.awardGoods="hide",this.isHuiKuan=!1,this.mainList=[],this.subList=[],this.goodsIdm=[],this.goodsId=[],this.ruleForm.tableData1=[],this.tableData=[{goodsNamem:"",specsMaxm:""}]},setRange:function(){var e=this;if(0==this.goodsId.length)this.$message.success("请先选择回款商品");else{var t={goodsId:this.goodsId.toString(),goodsIdm:this.goodsIdm.toString(),policyType:this.policyType};Object(g.c)(t).then(function(t){e.ruleForm.rangeList=t.data.data}),this.$refs.dialogSeleProMa.dialogShow()}},closeGoodsDiolog:function(){this.dialogSeleGoodsVisible=!1},closeDiolog:function(){this.dialogRangeVisible=!1},updataPage:function(e){var t=this.getsearchInfo(e.pageIndex,e.pageSize);this.initData(t)},setProvMange:function(e){var t=this;this.ruleForm.userId=[],e.forEach(function(e){t.ruleForm.userId.push(e.userId)})},saveAddPolGoods:function(){var e=this;if(""==this.ruleForm.policyType)return this.$message.success("请选择政策类型"),!1;if(""==this.ruleForm.title.trim())return this.$message.success("请输入政策名称"),!1;if(2==this.ruleForm.policyType&&""==this.ruleForm.policyTypeCheck)return this.$message.success("请选择政策子类型"),!1;if(""==this.ruleForm.policyStartDate||""==this.ruleForm.policyEndDate)return this.$message.success("请选择政策有效期"),!1;var t=[],s=!1;if(2==this.ruleForm.policyType){if(!(this.ruleForm.tableData1.length>0))return this.$message.success("请完善政策规则"),s=!1,!1;var a={},o=0;this.ruleForm.tableData1.slice().reverse().forEach(function(i){if(i.awardNum.trim().length>0&&i.afterDiscountPrice.trim().length>0)o+=1,a={goodsId:i.goodsId,awardNum:i.awardNum,discountPrice:i.afterDiscountPrice,batchNumber:i.batchNumber},t.push(a);else{if(0==i.awardNum.trim().length)return e.$message.success("请输入【"+i.goodsName+"】的奖励数量"),s=!1,!1;if(0==i.afterDiscountPrice.trim().length)return e.$message.success("请输入【"+i.goodsName+"】的折后价"),s=!1,!1}}),s=o==this.ruleForm.tableData1.length}else{var r=[],l=[];if(0==this.mainList.length)return this.$message.success("请添加需回款的商品"),s=!1,!1;var n={},d=0;if(this.mainList.slice().reverse().forEach(function(t){if(t.collectionNum.trim().length>0)d+=1,n={goodsId:t.goodsIdm,collectionNum:t.collectionNum},r.push(n);else if(0==t.collectionNum.trim().length)return e.$message.success("请输入【"+t.goodsNamem+"】的回款商品数量"),s=!1,!1}),s=d==this.mainList.length){if(0==this.subList.length)return this.$message.success("请添加奖励的商品"),s=!1,!1;var c={},u=0;this.subList.slice().reverse().forEach(function(t){if(t.awardNum.trim().length>0&&t.afterDiscountPrice.trim().length>0)u+=1,c={goodsId:t.goodsId,awardNum:t.awardNum,discountPrice:t.afterDiscountPrice,batchNumber:t.batchNumber},l.push(c);else{if(0==t.awardNum.trim().length)return e.$message.success("请输入【"+t.goodsName+"】的奖励数量"),s=!1,!1;if(0==t.afterDiscountPrice.trim().length)return e.$message.success("请输入【"+t.goodsName+"】的折后价"),s=!1,!1}}),s=u==this.subList.length,t={mainArray:r,subArray:l}}}if(s&&""==this.ruleForm.userId.length)return this.$message.success("请设置适用范围"),s=!1,!1;if(s){var m={policyType:this.ruleForm.policyType,policyStartDate:this.ruleForm.policyStartDate,policyEndDate:this.ruleForm.policyEndDate,title:this.ruleForm.title,verificationStartDate:this.ruleForm.verificationStartDate,verificationEndDate:this.ruleForm.verificationEndDate,remark:this.ruleForm.remark,policyRule:i()(t),policyRange:this.ruleForm.userId.toString(),policyTypeCheck:this.ruleForm.policyTypeCheck};Object(g.f)(m).then(function(t){1==t.data.code?e.$router.go(-1):e.$message.success(t.data.msg)})}}}},f={render:function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"create_wraper"},[s("go-back",{attrs:{title:"新增促销政策"}}),e._v(" "),s("el-form",{ref:"ruleForm",staticClass:"demo-form-inline",attrs:{model:e.ruleForm,inline:!0,"label-width":"100px"}},[s("div",{staticClass:"containInfo_wraper"},[s("div",{staticClass:"detail_title"},[s("i",{staticClass:"line_Icon"}),e._v("基本信息：")]),e._v(" "),s("div",{staticClass:"detail_content"},[s("el-row",{attrs:{gutter:20}},[s("el-col",{attrs:{span:7}},[s("el-form-item",{staticClass:"is-required",attrs:{label:"政策类型："}},[s("el-select",{attrs:{placeholder:"请选择政策类型"},on:{change:e.policyChange},model:{value:e.ruleForm.policyType,callback:function(t){e.$set(e.ruleForm,"policyType",t)},expression:"ruleForm.policyType"}},[s("el-option",{key:"1",attrs:{label:"奖励政策",value:"2"}}),e._v(" "),s("el-option",{key:"2",attrs:{label:"回款奖励",value:"3"}})],1)],1)],1),e._v(" "),s("el-col",{attrs:{span:7}},[s("el-form-item",{staticClass:" is-required",attrs:{label:"政策名称："}},[s("el-input",{attrs:{placeholder:"请输入政策名称"},model:{value:e.ruleForm.title,callback:function(t){e.$set(e.ruleForm,"title",t)},expression:"ruleForm.title"}})],1)],1),e._v(" "),s("el-col",{attrs:{span:10}},[s("div",{staticClass:"div-inline el-form-item is-required"},[s("div",{staticClass:"div-inline el-form-item__label"},[e._v("政策有效期：")]),e._v(" "),s("datepicker",{staticClass:"div-inline",attrs:{startIsShow:"true",endIsShow:"true"},on:{changeSelect:function(t){return e.changeSelect(t,"policyValidDate")}}})],1)]),e._v(" "),s("el-col",{attrs:{span:10}},[s("div",{staticClass:"div-inline el-form-item"},[s("div",{staticClass:"div-inline"},[e._v("核销期间：")]),e._v(" "),s("datepicker",{staticClass:"div-inline",attrs:{startIsShow:"true",endIsShow:"true"},on:{changeSelect:function(t){return e.changeSelect(t,"verifyDate")}}})],1)]),e._v(" "),s("el-col",{directives:[{name:"show",rawName:"v-show",value:2==e.ruleForm.policyType,expression:"ruleForm.policyType == 2"}],attrs:{span:7}},[s("div",{staticClass:"div-inline el-form-item is-required"},[s("div",{staticClass:"div-inline el-form-item__label"},[e._v("政策子类型：")]),e._v(" "),s("el-select",{attrs:{placeholder:"请选择政策子类型"},model:{value:e.ruleForm.policyTypeCheck,callback:function(t){e.$set(e.ruleForm,"policyTypeCheck",t)},expression:"ruleForm.policyTypeCheck"}},[s("el-option",{attrs:{label:"请选择政策子类型",value:""}}),e._v(" "),s("el-option",{key:"1",attrs:{label:"人员变动",value:"1"}}),e._v(" "),s("el-option",{key:"2",attrs:{label:"库存处理",value:"2"}}),e._v(" "),s("el-option",{key:"3",attrs:{label:"纯回款奖励",value:"3"}}),e._v(" "),s("el-option",{key:"4",attrs:{label:"会议奖励",value:"4"}})],1)],1)])],1),e._v(" "),s("el-row",[s("el-col",{attrs:{span:20}},[e._v("政策说明:"),s("textarea",{directives:[{name:"model",rawName:"v-model",value:e.ruleForm.remark,expression:"ruleForm.remark"}],staticClass:"poliyMark",attrs:{name:"",id:"",cols:"30",rows:"10"},domProps:{value:e.ruleForm.remark},on:{input:function(t){t.target.composing||e.$set(e.ruleForm,"remark",t.target.value)}}})])],1)],1)]),e._v(" "),s("div",{staticClass:"containInfo_wraper"},[s("div",{staticClass:"detail_title"},[s("i",{staticClass:"line_Icon"}),e._v("政策规则")]),e._v(" "),s("div",{staticClass:"table_wrap"},[s("select-goods",{ref:"dialogSeleGoods",attrs:{title:"选择商品",goodsList:e.goodsList,policyType:e.policyType,isradio:e.isradio},on:{getGoodsList:e.getGoodsList,selectAwardGoods:e.selectAwardGoods,closeGoodsDiolog:e.closeGoodsDiolog,uploadData:e.uploadData}}),e._v(" "),"hide"==e.awardGoods?s("div",{staticClass:"viewRemark",on:{click:e.selectAwardGoods}},[e._v("请选择需回款商品")]):e._e(),e._v(" "),"show"==e.awardGoods?s("div",[2==e.ruleForm.policyType?s("el-table",{attrs:{data:e.ruleForm.tableData1,border:"","tooltip-effect":"dark"}},[s("el-table-column",{attrs:{"render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[s("div",[e._v(e._s(t.row.goodsName)),s("span",{staticClass:"viewRemark",on:{click:function(s){e.deleScopeRow(t.row.goodsId)}}},[e._v("删除")])]),e._v(" "),s("div",[e._v(e._s(t.row.specsMax))])]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"awardNum",label:"奖励数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("input",{directives:[{name:"model",rawName:"v-model",value:t.row.awardNum,expression:"scope.row.awardNum"},{name:"vue-onkeypress",rawName:"v-vue-onkeypress"}],staticClass:"tableInput",attrs:{type:"number",oninput:"if(value.length>8)value=value.slice(0,8)"},domProps:{value:t.row.awardNum},on:{input:function(s){s.target.composing||e.$set(t.row,"awardNum",s.target.value)}}})]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"afterDiscountPrice",label:"折后价"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("input",{directives:[{name:"model",rawName:"v-model",value:t.row.afterDiscountPrice,expression:"scope.row.afterDiscountPrice"}],staticClass:"tableInput",attrs:{type:"number",oninput:"if(value.length>8)value=value.slice(0,8)"},domProps:{value:t.row.afterDiscountPrice},on:{keydown:e.handleInput2,input:function(s){s.target.composing||e.$set(t.row,"afterDiscountPrice",s.target.value)}}})]}}])}),e._v(" "),s("el-table-column",{attrs:{prop:"batchNumber",label:"指定批号"},scopedSlots:e._u([{key:"default",fn:function(t){return[s("input",{directives:[{name:"model",rawName:"v-model",value:t.row.batchNumber,expression:"scope.row.batchNumber"},{name:"vue-onkeypress",rawName:"v-vue-onkeypress"}],staticClass:"tableInput",domProps:{value:t.row.batchNumber},on:{input:function(s){s.target.composing||e.$set(t.row,"batchNumber",s.target.value)}}})]}}])})],1):e._e(),e._v(" "),e.isHuiKuan?[s("mainTable",{attrs:{items:e.mainList},on:{selectAwardGoods:e.selectAwardGoods,delItem:e.delItem}}),e._v(" "),s("subTable",{attrs:{items:e.subList},on:{selectAwardGoods:e.selectAwardGoods,delItem:e.delItem}})]:e._e()],2):e._e()],1)]),e._v(" "),s("div",{staticClass:"containInfo_wraper"},[s("div",{staticClass:"detail_title"},[s("i",{staticClass:"line_Icon"}),e._v("适用范围")]),e._v(" "),s("div",{staticClass:"detail_table"},[s("span",{staticClass:"viewRemark",on:{click:function(t){e.setRange()}}},[e._v("设置")]),e._v(" "),s("releaseRange",{ref:"dialogSeleProMa",attrs:{isView:!1,dialogRangeVisible:e.dialogRangeVisible,relRangeList:e.ruleForm.rangeList,title:"发布范围"},on:{setProvMange:e.setProvMange}})],1)])]),e._v(" "),s("div",{staticClass:"operateWraper"},[s("div",{staticClass:"div-inline el-button-red",on:{click:e.saveAddPolGoods}},[e._v("保存")])])],1)},staticRenderFns:[]};var y=s("C7Lr")(v,f,!1,function(e){s("OX9A"),s("Gx5l")},"data-v-4e727ca9",null);t.default=y.exports}});
//# sourceMappingURL=29.e6a90d326976158f73cc.js.map