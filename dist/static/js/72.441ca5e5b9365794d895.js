webpackJsonp([72],{ezCK:function(e,t,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=i("3cXf"),s=i.n(a),o=i("4YfN"),n=i.n(o),l=i("ROW2"),r=i("Agyp"),c=i("XH94"),d=i("zY1m"),u=i("a9+l"),p=i("olSa"),h=i("tA6g"),g=i("oynX"),m=i("55Vu"),v=i("cbU5"),y={data:function(){return{id:"",policyTypes:"",policyTypeCheck:"",policyType:"",policyStartDate:"",policyEndDate:"",title:"",verificationStartDate:"",verificationEndDate:"",departmentMenu:[],remark:"",tableData1:[],tableData2:[],tableData3:[],rangeList:[],userId:[],goodsList:"",isradio:!1,dialogSeleGoodsVisible:!1,tableData:[{goodsNamem:"",specsMaxm:""}],selectType:"",mainList:[],subList:[],goodsIdm:[],goodsId:[],pageIndex:1,pageSize:10,dialogRangeVisible:!1,awardGoods:"show"}},created:function(){0!=this.$route.query.type&&this.initData()},components:{goBack:r.a,departComponet:c.a,datepicker:d.a,elPagination:u.a,selectGoods:p.a,mainTable:g.a,subTable:m.a,releaseRange:h.a},methods:{initData:function(){var e=this;this.departmentMenu=JSON.parse(Object(l.b)("departmentMenu")),Object(v.d)({policyId:this.$route.query.id,policyType:this.$route.query.policyType}).then(function(t){var i=t.data.data;e.id=i.id,e.policyTypes=i.policyTypeStr,e.policyType=i.policyType,e.policyTypeCheck=i.policyTypeCheck+"",e.policyStartDate=i.policyStartDate,e.policyEndDate=i.policyEndDate,e.title=i.title,e.verificationStartDate=i.verificationStartDate,e.verificationEndDate=i.verificationEndDate,e.remark=i.remark,i.rangeList.forEach(function(t){1==t.isChoose&&e.userId.push(t.userId)}),e.mainList=i.mainList,e.subList=i.subList,e.mainList&&e.mainList.forEach(function(t){e.goodsIdm.push(t.goodsId)}),e.subList&&e.subList.forEach(function(t){e.goodsId.push(t.goodsId)}),e.rangeList=i.rangeList,2==i.policyType&&(e.tableData1=i.subList),3==i.policyType&&i.subList.forEach(function(t,a,s){console.log(t),console.log(i.mainList[0]);var o=n()({},t,i.mainList[0]);e.tableData2.push(o)}),4==i.policyType&&i.subList.forEach(function(t,a,s){var o={};e.mainList=i.mainList,console.log(e.mainList),e.subList=i.subList,o=i.mainList.length-1<a?n()({},t,i.mainList[i.mainList.length-1]):n()({},t,i.mainList[a]),e.tableData3.push(o)})})},changeSelect:function(e,t){console.log(e,t),"policyValidDate"==t?"startDate"==e.type?this.policyStartDate=e.data:this.policyEndDate=e.data:"startDate"==e.type?this.verificationStartDate=e.data:this.verificationEndDate=e.data},selectAwardGoods:function(e){var t=this;void 0!=e.handleType&&(this.handleType=e.handleType),1==e.pageIndex&&(this.pageIndex=e.pageIndex),"1"==e.handleType?this.selectType="mulAwardGoods":this.selectType="";var i={goodsName:void 0==e.name?"":e.name,pageIndex:this.pageIndex,pageSize:this.pageSize};""!=this.policyType?2!=this.policyType&&"show"==this.awardGoods||2==this.policyType||2!=this.policyType&&this.mainList.length>0?Object(v.a)(i).then(function(e){t.goodsList=e.data.data,t.$refs.dialogSeleGoods.dialogShow()}):2!=this.policyType&&0==this.mainList.length&&"hide"==this.awardGoods&&(this.isHuiKuan=!0,this.awardGoods="show"):this.$message.success("请先选择政策类型")},handleInput2:function(e){e.target.value=e.target.value.match(/^\d*(\.?\d{0,1})/g)[0]||null},uploadData:function(e){var t=this;2==this.policyType?(e.forEach(function(e,i,a){if(!t.goodsId.includes(e.id)){var s={goodsId:e.id,awardNum:"",afterDiscountPrice:"",batchNumber:"",goodsName:e.goodsName,specsMax:e.specsMax};t.tableData1.push(s),t.goodsId.push(e.id),t.clearProvMange()}}),this.awardGoods="show"):2!=this.policyType&&(1==this.handleType?e.forEach(function(e,i,a){if(!t.goodsIdm.includes(e.id)){var s;s={goodsIdm:e.id,goodsNamem:e.goodsName,specsMaxm:e.specsMax,collectionNum:""},t.mainList.push(s),t.goodsIdm.push(e.id),t.clearProvMange()}}):2==this.handleType&&e.forEach(function(e,i,a){if(!t.goodsId.includes(e.id)){var s;s={goodsId:e.id,awardNum:"",afterDiscountPrice:"",batchNumber:"",goodsName:e.goodsName,specsMax:e.specsMax},t.subList.push(s),t.goodsId.push(e.id),t.clearProvMange()}}),this.tableData2=[],this.tableData3=[],this.subList.forEach(function(e,i,a){var s={};s=t.mainList.length-1<i?n()({},e,t.mainList[t.mainList.length-1]):n()({},e,t.mainList[i]),3==t.policyType?t.tableData2.push(s):t.tableData3.push(s)}),this.tableData=this.mainList,this.awardGoods="show")},renderHeader:function(e){var t=this;return e("div",[e("span","奖励商品"),e("el-button",{class:["el-button--small"],on:{click:function(){t.selectAwardGoods({})}}},"添加奖励商品")])},renderHeader1:function(e){var t=this;return e("div",[e("span","需回款商品"),e("el-button",{class:["el-button--small"],on:{click:function(){t.selectAwardGoods({})}}},"添加需回款商品")])},delItem:function(e){1==e.handleType&&(this.mainList=this.mainList.filter(function(t){return t.goodsIdm!=e.goodId}),this.goodsIdm=this.goodsIdm.filter(function(t){return t!=e.goodId})),2==e.handleType&&(this.subList=this.subList.filter(function(t){return t.goodsId!=e.goodId}),this.goodsId=this.goodsId.filter(function(t){return t!=e.goodId})),this.clearProvMange()},deleScopeRow:function(e){this.tableData1=this.tableData1.filter(function(t){return t.goodsId!=e}),this.goodsId=this.goodsId.filter(function(t){return t!=e}),this.clearProvMange()},policyChange:function(e){this.policyType=e,this.awardGoods="hide",this.isHuiKuan=!1,this.mainList=[],this.subList=[],this.tableData1=[],this.goodsIdm=[],this.goodsId=[],this.tableData1=[],this.tableData=[{goodsNamem:"",specsMaxm:""}],this.clearProvMange()},setRange:function(){var e=this;if(this.policyTypes==this.policyType)return this.$refs.dialogSeleProMa.dialogShow(),!1;var t={goodsId:this.goodsId.toString(),goodsIdm:this.goodsIdm.toString(),policyType:this.policyType};Object(v.c)(t).then(function(t){e.rangeList=t.data.data}),this.$refs.dialogSeleProMa.dialogShow()},closeGoodsDiolog:function(){this.dialogSeleGoodsVisible=!1},closeDiolog:function(){this.dialogRangeVisible=!1},updataPage:function(e){this.pageIndex=e.pageIndex,this.pageSize=e.pageSize;var t=this.getsearchInfo(this.pageIndex,this.pageSize);this.initData(t)},setProvMange:function(e){var t=this;this.userId=[],e.forEach(function(e){t.userId.push(e.userId)})},clearProvMange:function(){this.userId=[],this.$refs.dialogSeleProMa.isHuixian=!1},getGoodsList:function(e){var t=this;this.pageIndex=e.pageIndex,this.pageSize=e.pageSize;var i={departmentIds:this.departmentId,goodsName:this.$refs.dialogSeleGoods.formInline.goodsName,pageIndex:this.pageIndex,pageSize:this.pageSize};Object(v.a)(i).then(function(e){t.goodsList=e.data.data})},saveAddPolGoods:function(){var e=this;if(""==this.policyType)return this.$message.success("请选择政策类型"),!1;if(""==this.title.trim())return this.$message.success("请输入政策名称"),!1;if(2==this.policyType&&""==this.policyTypeCheck)return this.$message.success("请选择政策子类型"),!1;if(""==this.policyStartDate||""==this.policyEndDate)return this.$message.success("请选择政策有效期"),!1;if(""==this.departmentId)return this.$message.success("请选择事业部"),!1;var t=[],i=!1;if(2==this.policyType)if(this.tableData1.length>0){var a={},o=0;this.tableData1.slice().reverse().forEach(function(i){i.awardNum.toString().length>0&&i.afterDiscountPrice.toString().length>0?(o+=1,a={goodsId:i.goodsId,awardNum:i.awardNum,discountPrice:i.afterDiscountPrice,batchNumber:i.batchNumber},t.push(a)):0==i.awardNum.length.toString()?e.$message.success("请输入【"+i.goodsName+"】的奖励数量"):0==i.afterDiscountPrice.toString().length&&e.$message.success("请输入【"+i.goodsName+"】的折后价")}),i=o==this.tableData1.length}else this.$message.success("请完善政策规则");else{var n=[],l=[];if(0==this.mainList.length)return this.$message.success("请添加需回款的商品"),i=!1,!1;var r={},c=0;if(this.mainList.slice().reverse().forEach(function(t){t.collectionNum.toString().length>0?(c+=1,r={goodsId:t.goodsIdm,collectionNum:t.collectionNum},n.push(r)):0==t.collectionNum.toString().length&&e.$message.success("请输入【"+t.goodsNamem+"】的回款商品数量")}),i=c==this.mainList.length,0==this.subList.length)return this.$message.success("请添加奖励的商品"),i=!1,!1;var d={},u=0;this.subList.slice().reverse().forEach(function(t){t.awardNum.toString().length>0&&t.afterDiscountPrice.toString().length>0?(u+=1,d={goodsId:t.goodsId,awardNum:t.awardNum,discountPrice:t.afterDiscountPrice,batchNumber:t.batchNumber},l.push(d)):0==t.awardNum.toString().length?e.$message.success("请输入【"+t.goodsName+"】的奖励数量"):0==t.afterDiscountPrice.toString().length&&e.$message.success("请输入【"+t.goodsName+"】的折后价")}),i=u==this.subList.length,t={mainArray:n,subArray:l}}if(""==this.userId.length)return this.$message.success("请设置适用范围"),i=!1,!1;if(i)if(1==this.$route.query.type){var p={id:this.id,policyType:this.policyType,policyStartDate:this.policyStartDate,policyEndDate:this.policyEndDate,title:this.title,verificationStartDate:this.verificationStartDate,verificationEndDate:this.verificationEndDate,departmentId:this.departmentId,remark:this.remark,policyRule:s()(t),policyRange:this.userId.toString(),policyTypeCheck:"null"==this.policyTypeCheck?"":this.policyTypeCheck};Object(v.g)(p).then(function(t){1==t.data.code?e.$router.go(-1):e.$message.success(t.data.msg)})}else{var h={policyType:this.policyType,policyStartDate:this.policyStartDate,policyEndDate:this.policyEndDate,title:this.title,verificationStartDate:this.verificationStartDate,verificationEndDate:this.verificationEndDate,departmentId:this.departmentId,remark:this.remark,policyRule:s()(t),policyRange:this.userId.toString(),policyTypeCheck:"null"==this.policyTypeCheck?"":this.policyTypeCheck};Object(v.f)(h).then(function(t){1==t.data.code?e.$router.go(-1):e.$message.success(t.data.msg)})}}}},f={render:function(){var e=this,t=e.$createElement,i=e._self._c||t;return i("div",{staticClass:"create_wraper"},[1==this.$route.query.type?i("go-back",{attrs:{title:"编辑促销政策"}}):i("go-back",{attrs:{title:"复制促销政策"}}),e._v(" "),i("el-form",{ref:"ruleForm",staticClass:"demo-form-inline",attrs:{inline:!0,"label-width":"100px"}},[i("div",{staticClass:"containInfo_wraper"},[i("div",{staticClass:"detail_title"},[i("i",{staticClass:"line_Icon"}),e._v("基本信息：")]),e._v(" "),i("div",{staticClass:"detail_content"},[i("el-row",{attrs:{gutter:20}},[i("el-col",{attrs:{span:7}},[i("el-form-item",{staticClass:"is-required",attrs:{label:"政策类型："}},[i("el-select",{attrs:{placeholder:"请选择政策类型"},on:{change:e.policyChange},model:{value:e.policyTypes,callback:function(t){e.policyTypes=t},expression:"policyTypes"}},[i("el-option",{key:"1",attrs:{label:"奖励政策",value:"2"}}),e._v(" "),3==e.policyType?i("el-option",{key:"2",attrs:{label:"回款奖励",value:"3"}}):4==e.policyType?i("el-option",{key:"3",attrs:{label:"回款奖励",value:"4"}}):i("el-option",{key:"4",attrs:{label:"回款奖励",value:"3"}})],1)],1)],1),e._v(" "),i("el-col",{attrs:{span:7}},[i("el-form-item",{staticClass:" is-required",attrs:{label:"政策名称："}},[i("el-input",{attrs:{placeholder:"请输入政策名称"},model:{value:e.title,callback:function(t){e.title=t},expression:"title"}})],1)],1),e._v(" "),i("el-col",{attrs:{span:10}},[i("div",{staticClass:"div-inline el-form-item is-required"},[i("div",{staticClass:"div-inline el-form-item__label"},[e._v("政策有效期：")]),e._v(" "),i("datepicker",{staticClass:"div-inline",attrs:{startIsShow:"true",endIsShow:"true",starTim:e.policyStartDate,endTim:e.policyEndDate},on:{changeSelect:function(t){return e.changeSelect(t,"policyValidDate")}}})],1)]),e._v(" "),i("el-col",{attrs:{span:10}},[i("div",{staticClass:"div-inline el-form-item"},[i("div",{staticClass:"div-inline"},[e._v("核销期间：")]),e._v(" "),i("datepicker",{staticClass:"div-inline",attrs:{startIsShow:"true",endIsShow:"true",starTim:e.verificationStartDate,endTim:e.verificationEndDate},on:{changeSelect:function(t){return e.changeSelect(t,"verifyDate")}}})],1)]),e._v(" "),i("el-col",{directives:[{name:"show",rawName:"v-show",value:2==e.policyType,expression:"policyType==2"}],attrs:{span:7}},[i("div",{staticClass:"div-inline el-form-item is-required"},[i("div",{staticClass:"div-inline el-form-item__label"},[e._v("政策子类型：")]),e._v(" "),i("el-select",{attrs:{placeholder:"请选择政策子类型"},model:{value:null==e.policyTypeCheck?"":e.policyTypeCheck,callback:function(t){null!=e.policyTypeCheck&&(e.policyTypeCheck=t)},expression:"policyTypeCheck == null?'':policyTypeCheck"}},[i("el-option",{attrs:{label:"请选择政策子类型",value:""}}),e._v(" "),i("el-option",{key:"1",attrs:{label:"人员变动",value:"1"}}),e._v(" "),i("el-option",{key:"2",attrs:{label:"库存处理",value:"2"}}),e._v(" "),i("el-option",{key:"3",attrs:{label:"纯回款奖励",value:"3"}}),e._v(" "),i("el-option",{key:"4",attrs:{label:"会议奖励",value:"4"}})],1)],1)])],1),e._v(" "),i("el-row",[i("el-col",{attrs:{span:20}},[e._v("政策说明:"),i("textarea",{directives:[{name:"model",rawName:"v-model",value:e.remark,expression:"remark"}],staticClass:"poliyMark",attrs:{name:"",id:"",cols:"30",rows:"10"},domProps:{value:e.remark},on:{input:function(t){t.target.composing||(e.remark=t.target.value)}}})])],1)],1)]),e._v(" "),i("div",{staticClass:"containInfo_wraper"},[i("div",{staticClass:"detail_title"},[i("i",{staticClass:"line_Icon"}),e._v("政策规则")]),e._v(" "),i("div",{staticClass:"table_wrap"},[i("select-goods",{ref:"dialogSeleGoods",attrs:{title:"选择商品",goodsList:e.goodsList,policyType:e.policyType,isradio:e.isradio},on:{getGoodsList:e.getGoodsList,selectAwardGoods:e.selectAwardGoods,closeGoodsDiolog:e.closeGoodsDiolog,uploadData:e.uploadData}}),e._v(" "),"hide"==e.awardGoods?i("div",{staticClass:"viewRemark",on:{click:e.selectAwardGoods}},[e._v("请选择需回款商品")]):e._e(),e._v(" "),"show"==e.awardGoods?i("div",[2==e.policyType?i("el-table",{attrs:{data:e.tableData1,border:"","tooltip-effect":"dark"}},[i("el-table-column",{attrs:{"render-header":e.renderHeader},scopedSlots:e._u([{key:"default",fn:function(t){return[i("div",[e._v(e._s(t.row.goodsName)),i("span",{staticClass:"viewRemark",on:{click:function(i){e.deleScopeRow(t.row.goodsId)}}},[e._v("删除")])]),e._v(" "),i("div",[e._v(e._s(t.row.specsMax))])]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"awardNum",label:"奖励数量"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.row.awardNum,expression:"scope.row.awardNum"},{name:"vue-onkeypress",rawName:"v-vue-onkeypress"}],staticClass:"tableInput",attrs:{type:"number",oninput:"if(value.length>8)value=value.slice(0,8)"},domProps:{value:t.row.awardNum},on:{input:function(i){i.target.composing||e.$set(t.row,"awardNum",i.target.value)}}})]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"afterDiscountPrice",label:"折后价"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.row.afterDiscountPrice,expression:"scope.row.afterDiscountPrice"}],staticClass:"tableInput",attrs:{type:"number",oninput:"if(value.length>8)value=value.slice(0,8)"},domProps:{value:t.row.afterDiscountPrice},on:{keydown:e.handleInput2,input:function(i){i.target.composing||e.$set(t.row,"afterDiscountPrice",i.target.value)}}})]}}])}),e._v(" "),i("el-table-column",{attrs:{prop:"batchNumber",label:"指定批号"},scopedSlots:e._u([{key:"default",fn:function(t){return[i("input",{directives:[{name:"model",rawName:"v-model",value:t.row.batchNumber,expression:"scope.row.batchNumber"},{name:"vue-onkeypress",rawName:"v-vue-onkeypress"}],staticClass:"tableInput",domProps:{value:t.row.batchNumber},on:{input:function(i){i.target.composing||e.$set(t.row,"batchNumber",i.target.value)}}})]}}])})],1):e._e(),e._v(" "),3==e.policyType||4==e.policyType?[i("mainTable",{attrs:{items:e.mainList},on:{selectAwardGoods:e.selectAwardGoods,delItem:e.delItem}}),e._v(" "),i("subTable",{attrs:{items:e.subList},on:{selectAwardGoods:e.selectAwardGoods,delItem:e.delItem}})]:e._e()],2):e._e()],1)]),e._v(" "),i("div",{staticClass:"containInfo_wraper"},[i("div",{staticClass:"detail_title"},[i("i",{staticClass:"line_Icon"}),e._v("适用范围")]),e._v(" "),i("div",{staticClass:"detail_table"},[i("span",{staticClass:"viewRemark",on:{click:function(t){e.setRange()}}},[e._v("设置")]),e._v(" "),i("releaseRange",{ref:"dialogSeleProMa",attrs:{isView:!1,dialogRangeVisible:e.dialogRangeVisible,relRangeList:e.rangeList,title:"发布范围"},on:{setProvMange:e.setProvMange}})],1)])]),e._v(" "),i("div",{staticClass:"operateWraper"},[i("div",{staticClass:"div-inline el-button-red",on:{click:e.saveAddPolGoods}},[e._v("保存")])])],1)},staticRenderFns:[]};var b=i("C7Lr")(y,f,!1,function(e){i("itmA")},"data-v-450b14ba",null);t.default=b.exports},itmA:function(e,t){}});
//# sourceMappingURL=72.441ca5e5b9365794d895.js.map