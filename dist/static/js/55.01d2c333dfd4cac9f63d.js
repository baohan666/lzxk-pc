webpackJsonp([55],{"4ls3":function(e,t){},"T/J/":function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("ZLEe"),s=a.n(o),i=a("Agyp"),r=a("/hMw"),n=a("ROW2"),l=a("DMbw"),d={name:"edit_removeGoods",data:function(){return{data2:[],checkedKeysArr:[],unCheckedKeysArrOld:[],defaultProps:{children:"children",label:"label"},activeName:"1",jsonData:{},goodsId:"",type:"",goodsDetai:{},checkList:"",manufacturerMenu:[],categoryMenu:[],drugTypeMenu:[],departmentMenu:[],departmentMenuSelf:[],dialogRangeVisible:!1,radio:"1",dialogTitle:"查看限购区域",checked1:[],checked2:[],checked3:[],UnmultiplChoice:[],province:[],cities:[],counties:[],imgList:[],provinceIndex:null,cityIndex:null,rules:{goodsName:[{required:!0,message:"请输入物料名称",trigger:"blur"}],materialCode:[{required:!0,message:"请输入物料编码",trigger:"blur"}],manufacturer:[{required:!0,message:"请选择生产企业",trigger:"change"}],drugType:[{required:!0,message:"请选择剂型",trigger:"change"}],specsMax:[{required:!0,message:"请输入规格",trigger:"blur"}],specsMin:[{required:!0,message:"请输入包装规格",trigger:"blur"}],category:[{required:!0,message:"请选择物料类别",trigger:"blur"}],departmentIds:[{required:!0,message:"请选择事业部",trigger:"blur"}],provincePrice:[{required:!0,message:"请输入省区经理开票价",trigger:"blur"}],cityPrice:[{required:!0,message:"请输入地区经理开票价",trigger:"blur"}],countyPrice:[{required:!0,message:"请输入县区经理开票价",trigger:"blur"}]}}},mounted:function(){this.getManufacturer(),this.getDrugType(),this.getCategory(),this.initData()},components:{uploadImg:r.a,goBack:i.a},methods:{handleClick:function(e,t){console.log("切换tab,event:",e,t)},initData:function(){var e=this;this.goodsId=this.$route.query.id,this.type=this.$route.query.type,Object(l.q)({id:this.goodsId,type:this.type}).then(function(t){e.goodsDetai=t.data.data,e.imgList=e.goodsDetai.imgList,console.log("this.goodsDetai:",e.goodsDetai),console.log(null==e.goodsDetai.departmentIds),null==e.goodsDetai.departmentIds||""==e.goodsDetai.departmentIds?e.goodsDetai.departmentIds=[]:e.goodsDetai.departmentIds=e.goodsDetai.departmentIds.split(",");var a=[];e.imgList.forEach(function(e,t,o){var s=e.split("/");a.push(s[s.length-1])}),e.goodsDetai.goodsImgs=a}),"null"!=Object(n.b)("departmentMenu")||Object(n.b)("departmentMenu")?this.departmentMenu=JSON.parse(Object(n.b)("departmentMenu")):this.departmentMenu=Object(n.c)(),console.log("this.departmentMenu:",this.departmentMenu);var t=function(t){var a={depId:t,goodsId:e.$route.query.id};Object(l.z)(a).then(function(a){console.log("key："+t+";对应值："+e.departmentMenu[t]),console.log("res.data.data.options:"+t+":",a.data.data.options),e.jsonData[t]=a.data.data.options;for(var o=e.jsonData[t],s=0;s<o.length;s++)if(2==o[s].isCheck&&e.unCheckedKeysArrOld.push(o[s].id),o[s].children)for(var i=0;i<o[s].children.length;i++)if(2==o[s].children[i].isCheck&&e.unCheckedKeysArrOld.push(o[s].children[i].id),o[s].children[i].children)for(var r=0;r<o[s].children[i].children.length;r++)2==o[s].children[i].children[r].isCheck&&e.unCheckedKeysArrOld.push(o[s].children[i].children[r].id)})};for(var a in this.departmentMenu)t(a)},handleInput2:function(e){e.target.value=e.target.value.match(/^\d*(\.?\d{0,1})/g)[0]||null},handleCheckedCitiesChange:function(e){console.log(e),console.log(this.goodsDetai.departmentIds)},toSave:function(e,t){var a=this;this.$refs[e].validate(function(e){if(console.log("valid:",e),!e)return a.$message.error("请将必填项填写完整！"),!1;if(1==t&&(0==a.goodsDetai.provincePrice||0==a.goodsDetai.cityPrice||0==a.goodsDetai.countyPrice))return a.$message.error("保存并上架时，销售信息下的开票价格必须大于0！"),!1;var o=1;console.log("保存this.unCheckedKeysArrOld:",a.unCheckedKeysArrOld),console.log("保存this.UnmultiplChoice:",a.UnmultiplChoice);var s=a.unCheckedKeysArrOld?a.unCheckedKeysArrOld:[],i=a.UnmultiplChoice?a.UnmultiplChoice:[];Array.prototype.equals=function(e){return this.sort().join()===e.sort().join()},s.equals(i)?(console.log("没修改"),o=2):(console.log("修改过"),o=1);var r=a.UnmultiplChoice.join(",");console.log("保存this.UnmultiplChoice：",a.UnmultiplChoice),console.log("保存treeIds：",r),"string"!=typeof a.goodsDetai.goodsImgs&&(a.goodsDetai.goodsImgs=a.goodsDetai.goodsImgs.join(","));var d=a.goodsDetai.departmentIds;console.log("保存departmentIds:",d);var c={id:a.goodsId,goodsName:a.goodsDetai.goodsName,materialCode:a.goodsDetai.materialCode,manufacturer:a.goodsDetai.manufacturer,category:a.goodsDetai.category,drugType:a.goodsDetai.drugType,specsMax:a.goodsDetai.specsMax,specsMin:a.goodsDetai.specsMin,unit:a.goodsDetai.unit,version:a.goodsDetai.version,licenseNumber:a.goodsDetai.licenseNumber,goodsImgs:a.goodsDetai.goodsImgs,remark:a.goodsDetai.remark,provincePrice:a.goodsDetai.provincePrice,cityPrice:a.goodsDetai.cityPrice,countyPrice:a.goodsDetai.countyPrice,departmentIds:d,treeIds:r,changStatus:o,type:t,userId:Object(n.b)("accountId")};Object(l.E)(c).then(function(e){a.$message.success("保存成功！"),a.$router.go(-1),console.log(e)})})},getManufacturer:function(){var e=this;Object(l.u)().then(function(t){e.manufacturerMenu=t.data.data})},getCategory:function(){var e=this;Object(l.m)("").then(function(t){e.categoryMenu=t.data.data})},getDrugType:function(){var e=this;Object(l.A)("").then(function(t){e.drugTypeMenu=t.data.data})},visualRange:function(){if(console.log("查看this.jsonData:",this.jsonData),console.log("查看Object.keys(this.jsonData).length:",s()(this.jsonData).length),console.log("查看可见范围this.goodsDetai.departmentIds:",this.goodsDetai.departmentIds),""!=this.goodsDetai.departmentIds||0!=this.goodsDetai.departmentIds.length)if(console.log("可销售事业部有勾选"),s()(this.jsonData).length==s()(this.departmentMenu).length){for(var e={},t=0;t<this.goodsDetai.departmentIds.length;t++)this.goodsDetai.departmentIds[t]in this.departmentMenu&&(e[this.goodsDetai.departmentIds[t]]=this.departmentMenu[this.goodsDetai.departmentIds[t]]);this.departmentMenuSelf=e,this.radio=s()(e)[0],this.activeName=s()(e)[0],this.getAreaData(),this.dialogRangeVisible=!0}else this.$message.error("数据加载中,请稍后点击查看");else this.$message.error("请选择可销售事业部")},getAreaData:function(){console.log("获取本地缓存省地县数据集合this.goodsDetai.departmentIds:",this.goodsDetai.departmentIds),console.log("获取本地缓存省地县数据集合this.jsonData:",this.jsonData);for(var e=0;e<this.goodsDetai.departmentIds.length;e++)if(console.log("this.goodsDetai.departmentIds[g]:",this.goodsDetai.departmentIds[e]),this.goodsDetai.departmentIds[e]in this.jsonData)for(var t=this.jsonData[this.goodsDetai.departmentIds[e]],a=0;a<t.length;a++)if(t[a].children)for(var o=0;o<t[a].children.length;o++)if(t[a].children[o].children)for(var s=0;s<t[a].children[o].children.length;s++)1==t[a].children[o].children[s].isCheck&&this.checkedKeysArr.push(t[a].children[o].children[s].id);else 1==t[a].children[o].isCheck&&this.checkedKeysArr.push(t[a].children[o].id);else 1==t[a].isCheck&&this.checkedKeysArr.push(t[a].id)},checkedKeys:function(e){var t=[];console.log("departmentMenuSelf:",this.departmentMenuSelf),console.log("jsonData:",this.jsonData);var a=[];for(var o in this.departmentMenuSelf)a.push(o);for(var s=0;s<a.length;s++)if(a[s]in this.jsonData){var i=this.jsonData[a[s]];console.log("jsonDataSelf:",i),console.log("保存"+s+":",this.$refs.tree[s].getCheckedKeys());var r=this.$refs.tree[s].getCheckedKeys();console.log("tree中被选中的id:this.$refs.tree[g].getCheckedKeys():",this.$refs.tree[s].getCheckedKeys());for(var n=[],l=0;l<i.length;l++)if(n.push(i[l].id),i[l].children)for(var d=0;d<i[l].children.length;d++)if(n.push(i[l].children[d].id),i[l].children[d].children)for(o=0;o<i[l].children[d].children.length;o++)n.push(i[l].children[d].children[o].id);console.log("所有arr2:",n),console.log("被选中的arr1:",r);for(l=0;l<r.length;l++)for(d=0;d<n.length;d++)n[d]==r[l]&&n.splice(d,1);t.push.apply(t,n),console.log("没被选中的arr3",t)}this.UnmultiplChoice=t,console.log("this.UnmultiplChoice:",this.UnmultiplChoice),this.dialogRangeVisible=!1},uploadSuccess:function(e){this.goodsDetai.goodsImgs=e.fileName}}},c={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"edit_wraper"},[a("go-back",{attrs:{title:"查看商品详情"}}),e._v(" "),a("el-form",{ref:"goodsDetai",staticClass:"demo-form-inline",attrs:{model:e.goodsDetai,inline:!0,rules:e.rules}},[a("div",{staticClass:"containInfo_wraper"},[a("div",{staticClass:"detail_title"},[a("i",{staticClass:"line_Icon"}),e._v("基本信息：")]),e._v(" "),a("div",{staticClass:"detail_content"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"物料名称：",prop:"goodsName"}},[a("el-input",{attrs:{placeholder:"请输入物料名称"},model:{value:e.goodsDetai.goodsName,callback:function(t){e.$set(e.goodsDetai,"goodsName",t)},expression:"goodsDetai.goodsName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"物料编码：",prop:"materialCode"}},[a("el-input",{attrs:{placeholder:"请输入物料编码"},model:{value:e.goodsDetai.materialCode,callback:function(t){e.$set(e.goodsDetai,"materialCode",t)},expression:"goodsDetai.materialCode"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"生产企业：",prop:"manufacturer"}},[a("el-select",{attrs:{placeholder:"请选择生产企业"},model:{value:e.goodsDetai.manufacturer,callback:function(t){e.$set(e.goodsDetai,"manufacturer",t)},expression:"goodsDetai.manufacturer"}},e._l(e.manufacturerMenu,function(e,t,o){return a("el-option",{key:o,attrs:{label:e,value:t}})}))],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"剂型：",prop:"drugType"}},[a("el-select",{attrs:{placeholder:"请选择剂型"},model:{value:e.goodsDetai.drugType,callback:function(t){e.$set(e.goodsDetai,"drugType",t)},expression:"goodsDetai.drugType"}},e._l(e.drugTypeMenu,function(e,t,o){return a("el-option",{key:o,attrs:{label:e,value:t}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"规格：",prop:"specsMax"}},[a("el-input",{attrs:{placeholder:"请输入规格"},model:{value:e.goodsDetai.specsMax,callback:function(t){e.$set(e.goodsDetai,"specsMax",t)},expression:"goodsDetai.specsMax"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"包装规格：",prop:"specsMin"}},[a("el-input",{attrs:{placeholder:"请输入包装规格"},model:{value:e.goodsDetai.specsMin,callback:function(t){e.$set(e.goodsDetai,"specsMin",t)},expression:"goodsDetai.specsMin"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"物料类别",prop:"category"}},[a("el-select",{attrs:{placeholder:"请选择物料类别"},model:{value:e.goodsDetai.category,callback:function(t){e.$set(e.goodsDetai,"category",t)},expression:"goodsDetai.category"}},e._l(e.categoryMenu,function(e,t,o){return a("el-option",{key:o,attrs:{label:e,value:t}})}))],1)],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"批准文号：",prop:"licenseNumber"}},[a("el-input",{attrs:{placeholder:"请输入批准文号"},model:{value:e.goodsDetai.licenseNumber,callback:function(t){e.$set(e.goodsDetai,"licenseNumber",t)},expression:"goodsDetai.licenseNumber"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"单位：",prop:"licenseNumber"}},[a("el-input",{attrs:{placeholder:"请输入单位"},model:{value:e.goodsDetai.unit,callback:function(t){e.$set(e.goodsDetai,"unit",t)},expression:"goodsDetai.unit"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:10}},[a("el-form-item",{attrs:{label:"版本号："}},[a("el-input",{attrs:{placeholder:"请输入单位"},model:{value:e.goodsDetai.version,callback:function(t){e.$set(e.goodsDetai,"version",t)},expression:"goodsDetai.version"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-form-item",{attrs:{label:"商品图片："}},[a("div",{staticClass:"div-inline uploadImg_box"},[a("upload-img",{attrs:{imgMenu:e.imgList,maxLimit:5,fileName:"goods",isInvert:!0},on:{uploadSuccess:e.uploadSuccess}})],1),e._v(" "),a("span",{staticClass:"uploadImg_tip"},[e._v("请上传图片，最多上传5张 ")])])],1)],1)]),e._v(" "),a("div",{staticClass:"containInfo_wraper"},[a("div",{staticClass:"detail_title"},[a("i",{staticClass:"line_Icon"}),e._v("销售信息：")]),e._v(" "),a("div",{staticClass:"detail_content"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:20}},[a("el-form-item",{attrs:{label:"可销售事业部：",prop:"departmentIds"}},[a("el-checkbox-group",{on:{change:e.handleCheckedCitiesChange},model:{value:e.goodsDetai.departmentIds,callback:function(t){e.$set(e.goodsDetai,"departmentIds",t)},expression:"goodsDetai.departmentIds"}},e._l(e.departmentMenu,function(t,o,s){return a("el-checkbox",{key:s,attrs:{label:o}},[e._v(e._s(t))])}))],1)],1)],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"省区经理开票价：",prop:"provincePrice"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.goodsDetai.provincePrice,expression:"goodsDetai.provincePrice"}],staticClass:"tableInput",attrs:{type:"number",placeholder:"请输入省区经理开票价"},domProps:{value:e.goodsDetai.provincePrice},on:{keydown:e.handleInput2,input:function(t){t.target.composing||e.$set(e.goodsDetai,"provincePrice",t.target.value)}}})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"地区经理开票价：",prop:"cityPrice"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.goodsDetai.cityPrice,expression:"goodsDetai.cityPrice"}],staticClass:"tableInput",attrs:{type:"number",placeholder:"请输入地区经理开票价"},domProps:{value:e.goodsDetai.cityPrice},on:{keydown:e.handleInput2,input:function(t){t.target.composing||e.$set(e.goodsDetai,"cityPrice",t.target.value)}}})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"县区经理开票价：",prop:"countyPrice"}},[a("input",{directives:[{name:"model",rawName:"v-model",value:e.goodsDetai.countyPrice,expression:"goodsDetai.countyPrice"}],staticClass:"tableInput",attrs:{type:"number",placeholder:"请输入县区经理开票价"},domProps:{value:e.goodsDetai.countyPrice},on:{keydown:e.handleInput2,input:function(t){t.target.composing||e.$set(e.goodsDetai,"countyPrice",t.target.value)}}})])],1)],1)],1)]),e._v(" "),a("div",{staticClass:"containInfo_wraper"},[a("div",{staticClass:"detail_title"},[a("i",{staticClass:"line_Icon"}),e._v("其他信息：")]),e._v(" "),a("div",{staticClass:"detail_content"},[a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:24}},[a("div",{staticClass:"grid-content bg-purple"},[a("span",[e._v("物料备注")]),e._v("：\n              "),a("textarea",{directives:[{name:"model",rawName:"v-model",value:e.goodsDetai.remark,expression:"goodsDetai.remark"}],staticClass:"poliyMark",attrs:{name:"",id:"",cols:"30",rows:"10"},domProps:{value:e.goodsDetai.remark},on:{input:function(t){t.target.composing||e.$set(e.goodsDetai,"remark",t.target.value)}}})])])],1),e._v(" "),a("el-row",{attrs:{gutter:20}},[a("el-col",{attrs:{span:10}},[a("div",{staticClass:"grid-content bg-purple"},[e._v("可见范围："),a("font",{staticClass:"viewRemark",on:{click:e.visualRange}},[e._v("查看")])],1)])],1)],1)])]),e._v(" "),a("div",{staticClass:"operateWraper"},[a("div",{staticClass:"div-inline el-button-red",on:{click:function(t){e.toSave("goodsDetai",2)}}},[e._v("保存")]),e._v(" "),a("div",{staticClass:"div-inline el-button-red",on:{click:function(t){e.toSave("goodsDetai",1)}}},[e._v("保存并上架")])]),e._v(" "),a("el-dialog",{staticClass:"el-dialog-visib-range",attrs:{title:e.dialogTitle,visible:e.dialogRangeVisible,"append-to-body":!0},on:{"update:visible":function(t){e.dialogRangeVisible=t}}},[a("div",{staticClass:"el-dialog-depart-radio"},[a("span",[e._v("销售组织：")])]),e._v(" "),a("div",{staticClass:"areaWraper"},[a("div",{staticStyle:{height:"300px","overflow-y":"auto"}},[a("el-tabs",{on:{"tab-click":e.handleClick},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},e._l(e.departmentMenuSelf,function(t,o,s){return a("el-tab-pane",{attrs:{label:t,name:o}},[a("el-tree",{ref:"tree",refInFor:!0,attrs:{data:e.jsonData[o],"show-checkbox":"","node-key":"id",accordion:!0,"default-checked-keys":e.checkedKeysArr,props:e.defaultProps}})],1)}))],1)]),e._v(" "),a("div",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("span",{staticClass:"dialog-cancel-btn dialoperateBtn",on:{click:function(t){e.dialogRangeVisible=!1}}},[e._v("取消")]),e._v(" "),a("span",{staticClass:"dialog-sure-btn dialoperateBtn",on:{click:e.checkedKeys}},[e._v("确定")])])])],1)},staticRenderFns:[]};var g=a("C7Lr")(d,c,!1,function(e){a("4ls3")},"data-v-b08b161a",null);t.default=g.exports}});
//# sourceMappingURL=55.01d2c333dfd4cac9f63d.js.map